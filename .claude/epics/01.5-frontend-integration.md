# Epic 1.5: Frontend Integration & Page Assembly

**Status**: Not Started
**Priority**: Critical
**Epic Owner**: Frontend Team
**Estimated Tasks**: 10
**Depends On**: Epic 0 (Project Setup), Epic 1 (UI Component Library)

---

## Overview

Build the integration layer that connects the UI component library to backend APIs, transforming static components into a functional multi-page application. This epic creates the TypeScript types, API clients, state management, and page assembly that enables users to interact with the token extraction and component generation system.

**Note**: This epic does NOT rebuild UI components (those exist from Epic 1). It assembles them into working pages with proper data flow and state management.

---

## Goals

1. Create TypeScript types matching all backend API contracts
2. Build API client wrapper with error handling and transforms
3. Setup TanStack Query for server state management and caching
4. Configure Zustand stores for client-side state
5. Assemble 5 application pages using existing UI components
6. Implement navigation and layout wrapper with workflow progress
7. Wire complete data flow: upload → extract → review → generate
8. Add loading states, error boundaries, and user feedback

---

## Success Criteria

- ✅ All API types match backend Pydantic models exactly
- ✅ API client handles errors with user-friendly messages
- ✅ TanStack Query caching reduces duplicate API calls
- ✅ Zustand stores maintain state across page navigation
- ✅ Dashboard page shows at http://localhost:3000 (replaces default Next.js)
- ✅ Token extraction page functional with screenshot upload
- ✅ Requirements, patterns, and preview pages assembled
- ✅ Navigation between all 5 pages works smoothly
- ✅ Loading skeletons show during async operations
- ✅ Error boundaries catch and display failures gracefully
- ✅ Data persists across page transitions
- ✅ No duplicate UI components created (reuse Epic 1 library)

---

## Wireframes

### Page References (Already Created)

**All 5 pages have existing wireframes** - this epic assembles them:

1. **Dashboard Page** - NEW (not in wireframes, simple project overview)
2. **Token Extraction** - [token-extraction-page.html](../wireframes/token-extraction-page.html)
3. **Requirements Review** - [requirements-review-page.html](../wireframes/requirements-review-page.html)
4. **Pattern Selection** - [pattern-selection-page.html](../wireframes/pattern-selection-page.html)
5. **Component Preview** - [component-preview-page.html](../wireframes/component-preview-page.html)

### Key Integration Points

**Data Flow Architecture**:
```
User Action (Page)
  → TanStack Query Hook
  → API Client (Axios)
  → Backend FastAPI Endpoint
  ← Response
  ← Update Zustand Store
  ← Re-render UI Components
```

**State Management**:
- **Server State** (TanStack Query): API responses, caching, mutations
- **Client State** (Zustand): Extracted tokens, workflow progress, UI preferences
- **URL State** (Next.js Router): Page navigation, query params

**Component Reuse** (from Epic 1):
- Base: `Button`, `Card`, `Badge`, `Tabs`, `Progress`, `Alert`, `Input`
- Composite: `RequirementCard`, `PatternCard`, `MetricCard`, `CodePreviewModal`
- Token: `TokenEditor`, `ColorPicker`, `TypographyEditor`, `SpacingEditor`

### User Flow
1. User lands on Dashboard (project overview)
2. Clicks "Extract Tokens" → Token Extraction page
3. Uploads screenshot OR enters Figma URL
4. System extracts tokens (shows progress) → stores in Zustand
5. User reviews/edits tokens → saved to state
6. Clicks "Continue" → Requirements page (Epic 2 workflow)
7. Pattern selection → Component preview (Epic 3-4 workflow)
8. Navigation maintains state throughout

**Quick Test:**
```bash
# View all wireframes
open .claude/wireframes/*.html
```

---

## User Stories

### Story 1.5.1: Dashboard Access
**As a** frontend developer
**I want to** see a dashboard when I visit localhost:3000
**So that** I can start a new component generation or view recent projects

### Story 1.5.2: API Integration
**As a** frontend developer
**I want** TypeScript types that match the backend API
**So that** I get compile-time safety and autocomplete for API calls

### Story 1.5.3: State Persistence
**As a** user
**I want** my extracted tokens to persist when I navigate between pages
**So that** I don't lose my work during the multi-step workflow

### Story 1.5.4: Error Handling
**As a** user
**I want** clear error messages when API calls fail
**So that** I know what went wrong and how to fix it

### Story 1.5.5: Page Assembly
**As a** developer
**I want** pages assembled from existing UI components
**So that** I don't duplicate component code across the app

---

## Tasks

### Task 1: Create TypeScript API Types
**Acceptance Criteria**:
- [ ] Create `app/src/types/api.types.ts` with all API interfaces
- [ ] Types match backend Pydantic models exactly:
  - `TokenExtractionRequest` / `TokenExtractionResponse`
  - `FigmaAuthRequest` / `FigmaAuthResponse`
  - `FigmaExtractRequest` / `FigmaExtractResponse`
  - `DesignTokens` (colors, typography, spacing)
- [ ] Create `app/src/types/token.types.ts` for domain models
- [ ] Create `app/src/types/component.types.ts` for UI props
- [ ] Export all types from `app/src/types/index.ts`
- [ ] Use TypeScript strict mode
- [ ] No `any` types without explicit justification

**Files**:
- `app/src/types/api.types.ts` (new)
- `app/src/types/token.types.ts` (new)
- `app/src/types/component.types.ts` (new)
- `app/src/types/index.ts` (new)

**Example**:
```typescript
// api.types.ts
export interface TokenExtractionResponse {
  tokens: DesignTokens;
  metadata: {
    filename: string;
    image: ImageMetadata;
    extraction_method: string;
  };
  confidence: Record<string, number>;
}

export interface DesignTokens {
  colors: Record<string, string>;
  typography: Record<string, any>;
  spacing: Record<string, any>;
}

// Note: Confidence scores are returned separately in the extraction response,
// not embedded in the token values. Backend returns:
// { tokens: DesignTokens, metadata: {...}, confidence?: {...} }
```

**Tests**:
- Types compile without errors
- Types match backend response structure
- Import paths resolve correctly

---

### Task 2: Build API Client with Axios
**Acceptance Criteria**:
- [ ] Install axios: `npm install axios` (NOT currently in package.json)
- [ ] Create `app/src/lib/api/client.ts` - Axios instance
- [ ] Base URL from env: `process.env.NEXT_PUBLIC_API_URL`
- [ ] Request interceptor adds headers (Content-Type, etc.)
- [ ] Response interceptor handles errors globally
- [ ] Timeout: 30 seconds for uploads, 10 seconds for other calls
- [ ] Create `app/src/lib/api/tokens.api.ts` - Token endpoints
- [ ] Create `app/src/lib/api/figma.api.ts` - Figma endpoints
- [ ] Error transform: Backend errors → user-friendly messages
- [ ] Export typed API functions

**Files**:
- `app/src/lib/api/client.ts` (new)
- `app/src/lib/api/tokens.api.ts` (new)
- `app/src/lib/api/figma.api.ts` (new)

**Client Setup**:
```typescript
// client.ts
import axios from 'axios';

const apiClient = axios.create({
  baseURL: process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000',
  timeout: 30000,
  headers: { 'Content-Type': 'application/json' },
});

// Response interceptor for error handling
apiClient.interceptors.response.use(
  (response) => response,
  (error) => {
    const message = error.response?.data?.detail || 'An error occurred';
    throw new Error(message);
  }
);

export default apiClient;
```

**API Functions**:
```typescript
// tokens.api.ts
export const extractTokensFromScreenshot = async (
  file: File
): Promise<TokenExtractionResponse> => {
  const formData = new FormData();
  formData.append('file', file);

  const { data } = await apiClient.post('/tokens/extract/screenshot', formData, {
    headers: { 'Content-Type': 'multipart/form-data' },
  });

  return data;
};

export const extractTokensFromFigma = async (
  request: FigmaExtractRequest
): Promise<FigmaExtractResponse> => {
  const { data } = await apiClient.post('/tokens/extract/figma', request);
  return data;
};
```

**Tests**:
- API client initialized with correct base URL
- Error interceptor transforms errors
- FormData upload works correctly
- TypeScript types inferred correctly

---

### Task 3: Setup TanStack Query Provider
**Acceptance Criteria**:
- [ ] Install `@tanstack/react-query` (if not installed)
- [ ] Create `app/src/lib/query/queryClient.ts`
- [ ] Configure QueryClient:
  - Default staleTime: 5 minutes (Figma cache TTL)
  - Default cacheTime: 10 minutes
  - Retry: 3 attempts with exponential backoff
  - RefetchOnWindowFocus: true
- [ ] Create provider in `app/src/app/providers.tsx`
- [ ] Wrap root layout with QueryClientProvider
- [ ] Add React Query Devtools (development only)

**Files**:
- `app/src/lib/query/queryClient.ts` (new)
- `app/src/app/providers.tsx` (new)
- `app/src/app/layout.tsx` (modify)

**Query Client Setup**:
```typescript
// queryClient.ts
import { QueryClient } from '@tanstack/react-query';

export const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 5 * 60 * 1000, // 5 minutes
      cacheTime: 10 * 60 * 1000, // 10 minutes
      retry: 3,
      refetchOnWindowFocus: true,
    },
  },
});
```

**Provider Wrapper**:
```typescript
// providers.tsx
'use client';

import { QueryClientProvider } from '@tanstack/react-query';
import { ReactQueryDevtools } from '@tanstack/react-query-devtools';
import { queryClient } from '@/lib/query/queryClient';

export function Providers({ children }: { children: React.ReactNode }) {
  return (
    <QueryClientProvider client={queryClient}>
      {children}
      {process.env.NODE_ENV === 'development' && <ReactQueryDevtools />}
    </QueryClientProvider>
  );
}
```

**Tests**:
- QueryClient configured correctly
- Provider wraps app
- Devtools visible in development

---

### Task 4: Create TanStack Query Hooks
**Acceptance Criteria**:
- [ ] Create `app/src/lib/query/hooks/useTokenExtraction.ts`
- [ ] Create `app/src/lib/query/hooks/useFigmaAuth.ts`
- [ ] Create `app/src/lib/query/hooks/useFigmaExtraction.ts`
- [ ] Use `useMutation` for POST endpoints
- [ ] Use `useQuery` for GET endpoints (if any)
- [ ] Handle loading, error, success states
- [ ] Invalidate queries on success (cache updates)
- [ ] Export typed hooks

**Files**:
- `app/src/lib/query/hooks/useTokenExtraction.ts` (new)
- `app/src/lib/query/hooks/useFigmaAuth.ts` (new)
- `app/src/lib/query/hooks/useFigmaExtraction.ts` (new)

**Hook Implementation**:
```typescript
// useTokenExtraction.ts
import { useMutation } from '@tanstack/react-query';
import { extractTokensFromScreenshot } from '@/lib/api/tokens.api';

export const useTokenExtraction = () => {
  return useMutation({
    mutationFn: extractTokensFromScreenshot,
    onSuccess: (data) => {
      // Update Zustand store (Task 5)
      useTokenStore.getState().setTokens(data.tokens);
    },
    onError: (error) => {
      console.error('Token extraction failed:', error);
    },
  });
};
```

**Tests**:
- Hooks return mutation/query objects
- Loading states work correctly
- Success handlers update stores
- Error handlers log/display errors

---

### Task 5: Create Zustand Stores
**Acceptance Criteria**:
- [ ] Create `app/src/stores/useTokenStore.ts`
  - State: extracted tokens, confidence scores, metadata
  - Actions: setTokens, updateToken, clearTokens
- [ ] Create `app/src/stores/useWorkflowStore.ts`
  - State: current step (extract/requirements/patterns/preview)
  - State: progress percentage
  - Actions: setStep, updateProgress
- [ ] Create `app/src/stores/useUIStore.ts`
  - State: modals, alerts, loading states
  - Actions: openModal, closeModal, showAlert
- [ ] Persist token store to localStorage (optional)
- [ ] TypeScript strict types for all stores

**Files**:
- `app/src/stores/useTokenStore.ts` (new)
- `app/src/stores/useWorkflowStore.ts` (new)
- `app/src/stores/useUIStore.ts` (new)

**Store Implementation**:
```typescript
// useTokenStore.ts
import { create } from 'zustand';
import type { DesignTokens } from '@/types';

interface TokenStore {
  tokens: DesignTokens | null;
  confidence: Record<string, number>;
  setTokens: (tokens: DesignTokens) => void;
  updateToken: (category: string, key: string, value: any) => void;
  clearTokens: () => void;
}

export const useTokenStore = create<TokenStore>((set) => ({
  tokens: null,
  confidence: {},
  setTokens: (tokens) => set({ tokens }),
  updateToken: (category, key, value) =>
    set((state) => ({
      tokens: {
        ...state.tokens!,
        [category]: {
          ...state.tokens![category],
          [key]: value,
        },
      },
    })),
  clearTokens: () => set({ tokens: null, confidence: {} }),
}));
```

**Tests**:
- Stores initialize with correct defaults
- Actions update state correctly
- Multiple components can access same store
- State persists across re-renders

---

### Task 6: Build Dashboard Page (Home)
**Acceptance Criteria**:
- [ ] Replace `app/src/app/page.tsx` default Next.js content
- [ ] Display project overview:
  - App name and version
  - Quick action buttons ("Extract Tokens", "View Patterns")
  - Recent generations list (empty state for now)
  - Metrics cards (total components, success rate - placeholder)
- [ ] Use existing components:
  - `<Card>` for sections
  - `<Button>` for actions
  - `<MetricCard>` for stats
- [ ] Navigation buttons link to `/extract`, `/patterns`
- [ ] Responsive layout (mobile, tablet, desktop)

**Files**:
- `app/src/app/page.tsx` (modify)

**Page Structure**:
```tsx
// page.tsx
import { Button } from '@/components/ui/button';
import { Card } from '@/components/ui/card';
import { MetricCard } from '@/components/composite/MetricCard';

export default function Dashboard() {
  return (
    <main className="container mx-auto p-8">
      <h1 className="text-4xl font-bold mb-8">ComponentForge</h1>

      <div className="grid grid-cols-3 gap-4 mb-8">
        <MetricCard label="Components Generated" value="0" />
        <MetricCard label="Success Rate" value="N/A" />
        <MetricCard label="Avg Generation Time" value="N/A" />
      </div>

      <Card className="p-6 mb-8">
        <h2 className="text-2xl mb-4">Quick Actions</h2>
        <div className="flex gap-4">
          <Button asChild>
            <Link href="/extract">Extract Tokens</Link>
          </Button>
          <Button variant="secondary" asChild>
            <Link href="/patterns">Browse Patterns</Link>
          </Button>
        </div>
      </Card>

      <Card className="p-6">
        <h2 className="text-2xl mb-4">Recent Generations</h2>
        <p className="text-muted-foreground">No components generated yet.</p>
      </Card>
    </main>
  );
}
```

**Tests**:
- Page renders without errors
- Navigation buttons link correctly
- Responsive layout works
- Components from Epic 1 imported correctly

---

### Task 7: Build Token Extraction Page
**Acceptance Criteria**:
- [ ] Create `app/src/app/extract/page.tsx`
- [ ] Implement wireframe: [token-extraction-page.html](../wireframes/token-extraction-page.html)
- [ ] Use existing components:
  - `<Tabs>` for Screenshot/Figma tabs
  - `<Card>` for upload zone
  - `<Progress>` for extraction progress
  - `<Badge>` for confidence scores
  - `<TokenEditor>` for token display/editing
  - `<Button>` for actions
- [ ] Screenshot tab:
  - Optional: Install `npm install react-dropzone` for better UX (NOT currently installed)
  - Drag-and-drop upload (use `react-dropzone` or native HTML5)
  - Show upload progress
  - Call `useTokenExtraction` hook
  - Display extracted tokens with confidence
- [ ] Figma tab:
  - PAT input validation
  - Figma URL input
  - Call `useFigmaAuth` then `useFigmaExtraction`
  - Show cache indicator
- [ ] Loading states with `<Skeleton>` during extraction
- [ ] Error handling with `<Alert>`
- [ ] Export buttons (JSON/CSS) using `<TokenExport>`
- [ ] "Continue" button navigates to `/requirements`

**Files**:
- `app/src/app/extract/page.tsx` (new)

**Page Implementation** (simplified):
```tsx
'use client';

import { useState } from 'react';
import { Tabs, TabsList, TabsTrigger, TabsContent } from '@/components/ui/tabs';
import { TokenEditor } from '@/components/tokens/TokenEditor';
import { useTokenExtraction } from '@/lib/query/hooks/useTokenExtraction';
import { useTokenStore } from '@/stores/useTokenStore';

export default function ExtractPage() {
  const { mutate, isLoading } = useTokenExtraction();
  const tokens = useTokenStore((state) => state.tokens);

  const handleUpload = (file: File) => {
    mutate(file);
  };

  return (
    <main className="container mx-auto p-8">
      <h1 className="text-3xl font-bold mb-6">Extract Design Tokens</h1>

      <Tabs defaultValue="screenshot">
        <TabsList>
          <TabsTrigger value="screenshot">Screenshot</TabsTrigger>
          <TabsTrigger value="figma">Figma</TabsTrigger>
        </TabsList>

        <TabsContent value="screenshot">
          {/* Upload zone, progress, token display */}
        </TabsContent>

        <TabsContent value="figma">
          {/* PAT input, Figma URL, token display */}
        </TabsContent>
      </Tabs>

      {tokens && <TokenEditor tokens={tokens} />}
    </main>
  );
}
```

**Tests**:
- Upload triggers API call
- Loading state shows skeleton
- Extracted tokens display correctly
- Confidence badges show colors
- Navigation to requirements works

---

### Task 8: Build Requirements, Patterns, Preview Pages
**Acceptance Criteria**:
- [ ] Create `app/src/app/requirements/page.tsx`
  - Implement wireframe: [requirements-review-page.html](../wireframes/requirements-review-page.html)
  - Use `<RequirementCard>`, `<Accordion>`, `<EditModal>`
  - Display requirements from Epic 2 (placeholder for now)
  - Accept/Review/Edit actions
- [ ] Create `app/src/app/patterns/page.tsx`
  - Implement wireframe: [pattern-selection-page.html](../wireframes/pattern-selection-page.html)
  - Use `<PatternCard>`, `<Input>` search, `<Dialog>` preview
  - Display patterns from Epic 3 (placeholder for now)
  - Selection triggers navigation to preview
- [ ] Create `app/src/app/preview/page.tsx`
  - Implement wireframe: [component-preview-page.html](../wireframes/component-preview-page.html)
  - Use `<Tabs>` for Preview/Code/Storybook/Quality
  - Use `<CodeBlock>` for code display
  - Use `<MetricCard>` for quality metrics
  - Download/copy functionality

**Files**:
- `app/src/app/requirements/page.tsx` (new)
- `app/src/app/patterns/page.tsx` (new)
- `app/src/app/preview/page.tsx` (new)

**Note**: These pages will have placeholder data until Epics 2-4 backends are complete.

**Tests**:
- All pages render without errors
- Components from Epic 1 reused correctly
- Navigation between pages works
- State persists across navigation

---

### Task 9: Create App Layout & Navigation
**Acceptance Criteria**:
- [ ] Modify `app/src/app/layout.tsx`:
  - Add `<Providers>` wrapper (TanStack Query)
  - Add navigation bar with links
  - Add workflow progress indicator
  - Add breadcrumbs
- [ ] Navigation shows current page
- [ ] Workflow progress shows completion percentage
- [ ] Footer with app version and links
- [ ] Responsive layout (mobile menu)
- [ ] Dark mode toggle (optional)

**Files**:
- `app/src/app/layout.tsx` (modify)
- `app/src/components/layout/Navigation.tsx` (new)
- `app/src/components/layout/Footer.tsx` (new)

**Layout Structure**:
```tsx
// layout.tsx
import { Providers } from './providers';
import Navigation from '@/components/layout/Navigation';
import Footer from '@/components/layout/Footer';

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en">
      <body>
        <Providers>
          <Navigation />
          {children}
          <Footer />
        </Providers>
      </body>
    </html>
  );
}
```

**Tests**:
- Navigation renders on all pages
- Active page highlighted
- Progress indicator updates
- Footer shows correct version

---

### Task 10: Add Loading States & Error Boundaries
**Acceptance Criteria**:
- [ ] Create `app/src/app/error.tsx` - Global error boundary
- [ ] Create `app/src/app/extract/loading.tsx` - Loading skeleton
- [ ] Create `app/src/app/requirements/loading.tsx`
- [ ] Create `app/src/app/patterns/loading.tsx`
- [ ] Create `app/src/app/preview/loading.tsx`
- [ ] Use `<Skeleton>` component from Epic 1
- [ ] Error boundary shows user-friendly message
- [ ] "Try Again" button on errors
- [ ] Loading states match wireframe designs

**Files**:
- `app/src/app/error.tsx` (new)
- `app/src/app/**/loading.tsx` (new files)

**Error Boundary**:
```tsx
// error.tsx
'use client';

import { Button } from '@/components/ui/button';
import { Alert } from '@/components/ui/alert';

export default function Error({
  error,
  reset,
}: {
  error: Error;
  reset: () => void;
}) {
  return (
    <div className="container mx-auto p-8">
      <Alert variant="error">
        <h2 className="text-xl font-bold mb-2">Something went wrong!</h2>
        <p>{error.message}</p>
        <Button onClick={reset} className="mt-4">Try Again</Button>
      </Alert>
    </div>
  );
}
```

**Tests**:
- Error boundary catches errors
- Loading skeletons show during navigation
- Suspense boundaries work correctly
- Error recovery (reset) works

---

## Dependencies

**Requires**:
- Epic 0: Project Setup (Docker, env vars, dependencies)
- Epic 1: UI Component Library (all base/composite components)

**Blocks**:
- Epic 2: Frontend tasks (assumes pages exist)
- Epic 3: Frontend tasks (assumes pages exist)
- Epic 4: Frontend tasks (assumes pages exist)

**Enables**:
- End-to-end testing (can test full workflows)
- User demos (functional UI)
- Epic 2-4 integration (pages ready to receive backend data)

---

## Technical Architecture

### Data Flow Diagram

```
┌─────────────────────────────────────────────────────┐
│                    Browser                          │
│                                                     │
│  ┌─────────────────────────────────────────────┐  │
│  │          Next.js App (Port 3000)            │  │
│  │                                             │  │
│  │  ┌──────────────────────────────────────┐  │  │
│  │  │        App Router Pages              │  │  │
│  │  │  /page.tsx (Dashboard)               │  │  │
│  │  │  /extract/page.tsx                   │  │  │
│  │  │  /requirements/page.tsx              │  │  │
│  │  │  /patterns/page.tsx                  │  │  │
│  │  │  /preview/page.tsx                   │  │  │
│  │  └──────────────┬───────────────────────┘  │  │
│  │                 │                           │  │
│  │                 ↓                           │  │
│  │  ┌──────────────────────────────────────┐  │  │
│  │  │      React Components (Epic 1)       │  │  │
│  │  │  - Base UI (Button, Card, etc.)      │  │  │
│  │  │  - Composite (RequirementCard, etc.) │  │  │
│  │  │  - Token Editors                     │  │  │
│  │  └──────────────┬───────────────────────┘  │  │
│  │                 │                           │  │
│  │                 ↓                           │  │
│  │  ┌──────────────────────────────────────┐  │  │
│  │  │       State Management               │  │  │
│  │  │                                      │  │  │
│  │  │  ┌────────────┐  ┌────────────────┐ │  │  │
│  │  │  │  Zustand   │  │ TanStack Query │ │  │  │
│  │  │  │  Stores    │  │  Cache         │ │  │  │
│  │  │  │            │  │                │ │  │  │
│  │  │  │ - Tokens   │  │ - Mutations    │ │  │  │
│  │  │  │ - Workflow │  │ - Queries      │ │  │  │
│  │  │  │ - UI State │  │ - Invalidation │ │  │  │
│  │  │  └────────────┘  └────────────────┘ │  │  │
│  │  └──────────────┬───────────────────────┘  │  │
│  │                 │                           │  │
│  │                 ↓                           │  │
│  │  ┌──────────────────────────────────────┐  │  │
│  │  │         API Client Layer             │  │  │
│  │  │  - Axios instance                    │  │  │
│  │  │  - Request/response interceptors     │  │  │
│  │  │  - Error transformation              │  │  │
│  │  │  - TypeScript types                  │  │  │
│  │  └──────────────┬───────────────────────┘  │  │
│  └─────────────────┼───────────────────────────┘  │
└────────────────────┼──────────────────────────────┘
                     │
                     ↓ HTTP
┌────────────────────────────────────────────────────┐
│          FastAPI Backend (Port 8000)               │
│                                                    │
│  POST /tokens/extract/screenshot                   │
│  POST /tokens/extract/figma                        │
│  POST /tokens/figma/auth                           │
│  GET  /tokens/defaults                             │
│                                                    │
└────────────────────────────────────────────────────┘
```

### Page-to-Store Mapping

| Page | Zustand Store | TanStack Query Hook | API Endpoint |
|------|---------------|---------------------|--------------|
| Dashboard | useWorkflowStore | - | - |
| Token Extraction | useTokenStore | useTokenExtraction | POST /tokens/extract/screenshot |
| Token Extraction (Figma) | useTokenStore | useFigmaExtraction | POST /tokens/extract/figma |
| Requirements | useRequirementsStore (Epic 2) | - | (Epic 2) |
| Patterns | usePatternsStore (Epic 3) | - | (Epic 3) |
| Preview | useComponentStore (Epic 4) | - | (Epic 4) |

### TypeScript Type Flow

```typescript
// Backend Pydantic → Frontend TypeScript
Backend: class TokenExtractionResponse(BaseModel)
  ↓
Frontend: interface TokenExtractionResponse

// API Client → TanStack Query → Zustand
API: extractTokensFromScreenshot(file: File): Promise<TokenExtractionResponse>
  ↓
Hook: useTokenExtraction() → useMutation
  ↓
Store: useTokenStore.setTokens(data.tokens)
  ↓
Component: const tokens = useTokenStore(state => state.tokens)
```

---

## Risks & Mitigation

| Risk | Impact | Mitigation |
|------|--------|------------|
| Type mismatches between frontend/backend | High | Auto-generate types from OpenAPI spec (future) |
| State sync issues across pages | Medium | Use Zustand for global state, URL params for page state |
| Stale cached data | Medium | TanStack Query invalidation on mutations |
| API errors not user-friendly | Medium | Transform errors in interceptors with clear messages |
| Component imports from Epic 1 broken | High | Verify all imports before starting pages |
| Duplicate component creation | Medium | Always check Epic 1 library first, enforce in code review |

---

## Definition of Done

- [ ] All 10 tasks completed with acceptance criteria met
- [ ] TypeScript types match backend Pydantic models
- [ ] API client handles all error cases gracefully
- [ ] TanStack Query caching works correctly
- [ ] Zustand stores maintain state across navigation
- [ ] Dashboard replaces default Next.js page
- [ ] Token extraction page functional (screenshot upload)
- [ ] Requirements/patterns/preview pages assembled (placeholder data)
- [ ] Navigation and layout functional
- [ ] Loading states and error boundaries working
- [ ] No duplicate UI components created (all from Epic 1)
- [ ] All pages responsive (mobile, tablet, desktop)
- [ ] Integration tests pass (page navigation, data flow)
- [ ] Documentation updated (API usage, state management)

---

## Related Epics

- **Depends On**: Epic 0, Epic 1
- **Blocks**: Epic 2, Epic 3, Epic 4 (frontend tasks)
- **Enables**: End-to-end testing, user demos

---

## Notes

**Critical Success Factor**: This epic MUST reuse all components from Epic 1. Do NOT create new Button, Card, or any UI components. The goal is assembly, not rebuilding.

**Epic 2-4 Integration**: Pages for requirements/patterns/preview will initially have placeholder data. They'll be "wired up" when Epics 2-4 backend APIs are complete.

**Performance**: Use React Suspense and streaming for better UX. Loading skeletons should match wireframe designs exactly.

**Testing Strategy**: Integration tests should cover full user flows (upload → extract → navigate → persist state). Unit tests for stores and API client.

**Development Order**:
1. Start with types and API client (foundation)
2. Setup TanStack Query and Zustand
3. Build dashboard (simplest page)
4. Build token extraction (most complex, tests entire stack)
5. Build remaining pages (requirements, patterns, preview)
6. Add layout and navigation
7. Polish with loading/error states
